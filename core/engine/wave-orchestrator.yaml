# SAGE Wave Orchestrator Specification
# Language-agnostic specification for wave execution phases, parallelization rules, and timing

version: "1.0.0"
specification_name: "Wave Orchestrator"
specification_type: "core_engine"

wave_execution_model:
  description: "Progressive build approach with increasing refinement"
  philosophy: |
    - Each wave builds upon the previous, adding layers of functionality
    - Early waves maximize parallelization for rapid foundation building
    - Later waves focus on integration and polish with reduced parallelization
    - Time-boxed execution prevents analysis paralysis
    
  wave_characteristics:
    wave_1:
      name: "Foundation"
      completion_target: "80%"
      focus_areas:
        - "Core infrastructure setup"
        - "Database schema and models"
        - "Basic API endpoints"
        - "Authentication framework"
        - "Essential UI components"
      parallelization_strategy: "maximum"
      agent_coordination: "minimal"
      
    wave_2:
      name: "Features"
      completion_target: "90%"
      focus_areas:
        - "Business logic implementation"
        - "API integration"
        - "UI feature completion"
        - "Basic testing"
        - "Error handling"
      parallelization_strategy: "moderate"
      agent_coordination: "increased"
      
    wave_3:
      name: "Polish"
      completion_target: "100%"
      focus_areas:
        - "Code refinement"
        - "Performance optimization"
        - "Comprehensive testing"
        - "Documentation"
        - "Deployment preparation"
      parallelization_strategy: "minimal"
      agent_coordination: "maximum"

parallelization_rules:
  core_principles:
    - "Maximize independent work streams"
    - "Minimize inter-agent dependencies"
    - "Prevent resource conflicts proactively"
    - "Enable graceful degradation on delays"
    
  dependency_categories:
    hard_dependencies:
      description: "Must be completed before dependent work can begin"
      examples:
        - "Database schema before ORM models"
        - "API contracts before client implementation"
        - "Authentication before protected endpoints"
      handling: "Block dependent agents until resolved"
      
    soft_dependencies:
      description: "Preferred but not blocking"
      examples:
        - "UI mockups before implementation"
        - "Test data before integration tests"
        - "Documentation templates before writing"
      handling: "Proceed with temporary placeholders"
      
    runtime_dependencies:
      description: "Discovered during execution"
      examples:
        - "Shared utility functions"
        - "Common type definitions"
        - "Configuration constants"
      handling: "Dynamic resolution through message queue"
  
  conflict_prevention:
    branch_isolation:
      description: "Each agent works on isolated git branch"
      naming_pattern: "feat/wave{N}-{component}-{timestamp}"
      merge_strategy: "Sequential by completion order"
      
    file_locking:
      description: "Prevent concurrent modifications"
      lock_granularity: "file"
      lock_duration: "until_commit_or_timeout"
      timeout: "2_hours"
      
    namespace_allocation:
      description: "Pre-assign code namespaces to agents"
      examples:
        - "API routes by resource"
        - "UI components by feature"
        - "Database tables by domain"

timing_configuration:
  wave_durations:
    wave_1:
      maximum: "120_minutes"
      checkpoints:
        - "30_minutes: Foundation components started"
        - "60_minutes: Core infrastructure complete"
        - "90_minutes: Basic functionality working"
        - "120_minutes: Wave handoff preparation"
        
    wave_2:
      maximum: "60_minutes"
      checkpoints:
        - "20_minutes: Feature implementation started"
        - "40_minutes: Integration points connected"
        - "60_minutes: Feature freeze and testing"
        
    wave_3:
      maximum: "30_minutes"
      checkpoints:
        - "10_minutes: Polish tasks identified"
        - "20_minutes: Optimizations complete"
        - "30_minutes: Final validation"
  
  agent_timing:
    status_update_interval: "15_minutes"
    health_check_interval: "5_minutes"
    stall_detection_threshold: "30_minutes"
    automatic_handoff_timeout: "wave_duration"

orchestration_phases:
  pre_wave:
    description: "Preparation before agents are deployed"
    duration: "variable"
    activities:
      - "Context analysis from source_documents"
      - "Dependency graph construction"
      - "Agent capability matching"
      - "Task allocation planning"
      - "Conflict prevention setup"
    outputs:
      - "Agent assignment matrix"
      - "Dependency resolution order"
      - "Parallelization plan"
      - "Risk mitigation strategies"
      
  wave_execution:
    description: "Active development phase"
    monitoring:
      - "Real-time progress tracking"
      - "Dependency satisfaction checking"
      - "Conflict detection and resolution"
      - "Performance metrics collection"
    intervention_triggers:
      - "Agent stall detection"
      - "Cascading dependency delays"
      - "Resource conflict escalation"
      - "Critical path delays"
      
  post_wave:
    description: "Consolidation and handoff"
    duration: "15_minutes"
    activities:
      - "Branch integration"
      - "Artifact collection"
      - "Progress assessment"
      - "Next wave planning"
      - "Knowledge transfer"
    outputs:
      - "Wave completion report"
      - "Integrated codebase"
      - "Dependency updates"
      - "Lessons learned"

wave_transition_protocol:
  handoff_requirements:
    from_wave_1_to_2:
      mandatory:
        - "Core infrastructure operational"
        - "Database schema finalized"
        - "Authentication working"
        - "Basic API structure"
      optional:
        - "All UI components"
        - "Complete test coverage"
        - "Full documentation"
        
    from_wave_2_to_3:
      mandatory:
        - "All features implemented"
        - "Integration points connected"
        - "Basic testing passing"
        - "No critical bugs"
      optional:
        - "Performance optimization"
        - "Code beautification"
        - "Comprehensive docs"
  
  knowledge_transfer:
    artifacts:
      - "Updated dependency graph"
      - "Completed task list"
      - "Known issues log"
      - "Technical decisions record"
    format: "Structured markdown with metadata"
    location: "wave_contexts/wave_{N}/"

performance_metrics:
  wave_level:
    - "Completion percentage"
    - "Agent utilization rate"
    - "Dependency resolution time"
    - "Conflict occurrence rate"
    - "Rework percentage"
    
  agent_level:
    - "Task completion rate"
    - "Code quality score"
    - "Integration success rate"
    - "Communication responsiveness"
    - "Handoff readiness"
    
  system_level:
    - "Overall build progress"
    - "Time to working prototype"
    - "Defect introduction rate"
    - "Knowledge retention score"
    - "Process efficiency index"

adaptation_mechanisms:
  dynamic_reallocation:
    description: "Adjust agent assignments based on progress"
    triggers:
      - "Significant delays detected"
      - "Unexpected complexity discovered"
      - "Agent failure or timeout"
    actions:
      - "Reassign blocked tasks"
      - "Merge similar work streams"
      - "Escalate to next wave"
      
  wave_extension:
    description: "Extend wave duration when necessary"
    maximum_extension: "30_minutes"
    approval_required: true
    conditions:
      - "Critical path nearly complete"
      - "High value tasks remaining"
      - "No cascading delays"
      
  scope_adjustment:
    description: "Move tasks between waves"
    criteria:
      - "Task complexity reassessment"
      - "Dependency chain analysis"
      - "Business priority changes"
    process:
      - "Identify candidate tasks"
      - "Assess impact analysis"
      - "Update wave plans"
      - "Communicate changes"